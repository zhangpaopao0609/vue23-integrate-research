# TD 架构升级思路

## 0. 背景
先来回顾一下为啥要升级呢？找出我们的目的是什么。

原因：想要整合 vue23，用一个仓库（一套代码）来实现 vue23，所以现有的 vue3 仓库肯定是无法支持了。

那么趁这个机会来重新进行项目设计。
> 所以这里说是升级，其实就是重新设计

既然是重新设计，那么是不是可以用一些有趣一点的东西。

那就从整体到细节写写自己的思考吧！

## 1. 仓库模式
无非两种选择，是否使用 workspace
> 完，我有点拿不准这个叫不叫仓库模式了，先这样叫吧

### 1.1 不使用 workspace
也就是说整个仓库值存在一个 package.json。

因为最终是要打两个包，然后发布，所以可以想到的是，打包 vue2 vue3 是两个命令呈现在 package.json 中。

也就是说 npm 包产物，无论是 2 还是 3，用户获取到的 package.json 一定是 2 3 共用的，这就会给用户带来疑惑。

这里只是简单说了 package.json 中的命令可能 23 均存在，实际上一定不止这些，像 name version 等等

> 当然，你说用一些黑科技，比如打包的时候重写 package.json 就可以了，这也是可行的，但这就很

所以，这显然淘汰。

### 1.2 使用 workspace
按业界叫法，勉强叫做单仓吧，也就是说每一个子应用都是一个独立的包，应用和应用之间利用包管理的 [workspace](https://pnpm.io/workspaces) 机制实现包共享。

单仓的话，那么可以预见的是：
- vue2 vue3 将分别是一个单独的子应用，打包的产物从各自应用中获取
- 公共方法是一个单独的子应用
- 组件是一个单独的子应用

这多清晰，好吧，所以，我肯定选择使用 workspace

## 2. 包管理工具
既然要用 workspace，那么首先就要确定包管理器。

那这个就不说了吧，pp 首选。

> 幽灵依赖、依赖体积、workspace 都杠杠的

> 好，这里有个 np 问题，之前也遇到和讨论过的。lock 文件是否上传？后面我们再讨论好吧

## 3. 构建

还是老样子，肯定用 gulp
- gulp

## 4. 发包

- vue2 3 单独发包这个没问题
- 每个子应用是否要发包

## 5. 测试

## 6. 文档

## 7. 官网